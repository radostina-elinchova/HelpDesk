@model HelpDeskApp.ViewModels.Models.Project.ProjectDetailsVM

@{
    ViewData["Title"] = "Project Details";
}

<div class="odoo-container">
    <div class="odoo-card">

        <!-- Action bar -->
        <div class="odoo-card-header odoo-header-actions">
            <div>
                <h3>@Model.ProjectName</h3>
                <p class="odoo-subtitle">Project details</p>
            </div>

            @if (User.Identity!.IsAuthenticated && User.IsInRole("Administrator"))
            {
                <a asp-action="Edit"
                   asp-route-id="@Model.Id"
                   class="btn odoo-btn-primary">
                    Edit
                </a>
            }
        </div>

        <!-- Body -->
        <div class="odoo-card-body">
            <div class="odoo-form odoo-form-readonly">

                <div class="odoo-field">
                    <label class="odoo-label">Project Name</label>
                    <div class="odoo-value">
                        @Model.ProjectName
                    </div>
                </div>

                <div class="odoo-field">
                    <label class="odoo-label">Description</label>
                    <div class="odoo-value odoo-value-multiline">
                        @Model.Description
                    </div>
                </div>

            </div>
        </div>

        <!-- TICKETS SECTION -->
        <div class="odoo-card-body border-top">

            <div class="d-flex justify-content-between align-items-center mb-2">
                <h5 class="mb-0">Tickets</h5>

                <a asp-controller="Ticket"
                   asp-action="Create"
                   asp-route-projectId="@Model.Id"
                   class="btn btn-sm odoo-btn-primary">
                    + New Ticket
                </a>
            </div>

            @if (Model.Tickets != null && Model.Tickets.Any())
            {
                <div class="table-responsive">
                    <table class="table odoo-table align-middle">
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Category</th>
                                <th>Status</th>
                                <th class="text-end"></th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var ticket in Model.Tickets)
                            {
                                <tr>
                                    <td>@ticket.Title</td>
                                    <td>@ticket.Category</td>
                                    <td>
                                        <span class="badge odoo-badge">
                                            @ticket.Status
                                        </span>
                                    </td>
                                    <td class="text-end">
                                        <a asp-controller="Ticket"
                                           asp-action="Details"
                                           asp-route-id="@ticket.Id"
                                           class="btn btn-sm odoo-btn-secondary">
                                            Open
                                        </a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <div class="odoo-empty-state text-center py-4 text-muted">
                    <i class="fas fa-ticket-alt fa-2x mb-2"></i>
                    <p class="mb-0">Няма тикети към този проект</p>
                </div>
            }

        </div>

        <!-- Footer -->
        <div class="odoo-card-footer">
            <a asp-action="Index"
               class="btn odoo-btn-secondary">
                Back to list
            </a>
        </div>

    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
}
